$(function(){function t(){event.cancelable&&event.preventDefault()}function e(){event.cancelable&&event.stopPropagation()}function l(t){$(".modelTypeUl").find("li").css("width",c/4),$(".modelTypeUl").css("width",t*c/4)}function n(t){$(".modelUl").css("width",c*t),$("table").css("width",c-20);var e=$(".modelUl table").last().find("tr").length;$(".modelUl table").last().find("tr").last().find("td").length;1==e&&$(".modelUl table").last().css("width",e*c/4),$("table").find("td").css("width",c/4)}function s(t){var e=0;!function(){var t=document.getElementById("modelTypeUl"),l=0,n=0;t.addEventListener("touchstart",function(t){l=t.touches[0].pageX}),t.addEventListener("touchmove",function(t){n=t.touches[0].pageX,e=parseInt(n)-parseInt(l)})}();var l=0,n=-t*c/4+c;$(".modelTypeUl").swipe(function(){(l+=e)<-n&&(l=-n),e>0&&l>0&&(l=0),console.log("moveLen:"+e),console.log("leftLen:"+l),$(this).css("margin-left",l),console.log($(this).css("margin-left"))})}function o(){u=1,i("all"),$(".modelType ul").on("tap",function(t){e(),u=1,$(t.target).css("background-color","#989898"),$(t.target).siblings().css("background-color","#DBDBDB"),i($(t.target).val())}),$(".modelType ul li:first-child").css("background-color","#989898"),d()}function i(t){$.post("/simulation/model/search",{searchKey:"",categoryId:t},function(t){for(var e="<li><table><tr class='row'>",l=JSON.parse(t),n=0,s=l.result.length;n<s;n++){var o=l.result[n].img;o="http://file.longmap.com"+o.substring(o.indexOf(",")+1,o.length),n%8==0&&0!=n?e+="</tr></table></li><li><table><tr class='row'>":n%4==0&&0!=n&&(e+="</tr><tr class='row'>"),e+="<td class='col-md-3'><img src="+o+"><p class='modeName'>"+l.result[n].name+"</p></td>"}e+="</tr></table></li>",$(".modelUl").empty().append(e),a(f=Math.ceil(l.result.length/8)),r(f,u)})}function a(t){var l=t,s=0;f=t,$(".modelUl").css("margin-left","0px"),n(l);var o=$(".modelUl table").last().find("tr").length;$(".modelUl table").last().find("tr").last().find("td").length;1==o&&$(".modelUl table").last().css("width",c-20),$("table").find("td").css("width",c/4),$(".modelUl").off("swipeLeft").on("swipeLeft",function(){s<l-1&&(u++,$(this).css("margin-left",-(parseInt(c)-10)*++s+"px"),r(f,u)),e()}),$(".modelUl").off("swipeRight").on("swipeRight",function(){s>0&&(u--,$(this).css("margin-left",-parseInt(c-10)*--s+"px"),r(f,u)),e()})}function d(){$(".modelUl").tap(function(t){var l=t.target;if("img"==l.tagName.toLowerCase()){var n=$(l).attr("src");console.log(n);var s={type:"simulation_addmodel",url:n};window.parent.sendToMap(s)}e()})}function r(t,e){for(var l="",n=0;n<t;n++)l+=n!=e-1?"<span><img src='/resources/img/mobile/unselect.png'></span>":"<span><img src='/resources/img/mobile/selected.png'></span>";$(".dotBox").empty().append(l)}document.addEventListener("touchmove",function(e){t()});$(".modelTypeUl").find("li");var c=window.screen.width,m=window.screen.height;$("body, #mapBox").css("width",c),$("#mapBox").css("height",m);var f=0,p=0;window.onresize=function(){c=window.innerWidth,m=window.innerHeight,$("body, #mapBox").css("width",c),$("body, #mapBox").css("height",m),l(p),$(".modelUl").css("width",c*f),$("table").css("width",c-20);$(".modelUl table").last().find("tr").length,$(".modelUl table").last().find("tr").last().find("td").length;$("table").find("td").css("width",c/4)},$.post("/simulation/model/type/search",{searchKey:""},function(t){for(var e="<li value='all'>全部</li>",n=JSON.parse(t),i=n.result.length,a=0;a<i;a++)e+="<li value="+n.result[a].id+">"+n.result[a].name+"</li>";i<3&&(e+="<li value='other'>其他</li>"),$(".modelTypeUl").append(e),l(i+1),s(i+1),o(),p=i+1});var u=1;$(".dotBox").tap(function(){e()}),r(f,u)});